<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delivery Address | Lunsara</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f1f3f6;
            color: #212121;
            line-height: 1.4;
        }

       /* Header Styles */
        header {
            background-color: #8e44ad;
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 2rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15), 0 2px 8px rgba(142, 68, 173, 0.3);
        }

        header h2 {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-weight: 700;
            margin: 0;
        }

        .logo {
            height: 40px;
            width: auto;
            margin-right: 5px;
        }

        header h2 small a {
            color: #ddd;
            text-decoration: none;
        }

        .navbar {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .navbar a {
            color: white;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 5px;
            transition: background-color 0.3s ease, color 0.3s ease;
            display: flex;
            align-items: center;
        }

/* Logout Confirmation Modal Styles */
.logout-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    z-index: 10001;
    display: none; /* Hidden by default */
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(5px);
}

.logout-modal-content {
    background: white;
    border-radius: 20px;
    padding: 30px;
    max-width: 400px;
    width: 90%;
    text-align: center;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    transform: scale(0.8);
    opacity: 0;
    transition: all 0.3s ease;
}

/* This class is added by JavaScript to trigger the animation */
.logout-modal.show .logout-modal-content {
    transform: scale(1);
    opacity: 1;
}

.logout-modal-icon {
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, #e74c3c, #c0392b);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 20px;
    font-size: 32px;
    color: white;
}

.logout-modal-title {
    font-size: 24px;
    font-weight: 600;
    color: #333;
    margin-bottom: 10px;
}

.logout-modal-message {
    color: #666;
    font-size: 16px;
    line-height: 1.5;
    margin-bottom: 25px;
}

.logout-modal-buttons {
    display: flex;
    gap: 15px;
    justify-content: center;
}

.logout-modal-btn {
    padding: 12px 24px;
    border: none;
    border-radius: 10px;
    font-size: 16px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    min-width: 120px;
}

.logout-modal-btn-primary {
    background: linear-gradient(135deg, #e74c3c, #c0392b);
    color: white;
}

.logout-modal-btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
}

.logout-modal-btn-secondary {
    background: #f8f9fa;
    color: #666;
    border: 2px solid #e1e5e9;
}

.logout-modal-btn-secondary:hover {
    background: #e9ecef;
    border-color: #e74c3c;
    color: #e74c3c;
}
        /* Profile Status Bar Styles */
        .profile-status-bar {
            background: linear-gradient(135deg, #8e44ad, #9b59b6);
            border-radius: 25px;
            padding: 8px 16px;
            box-shadow: 0 4px 15px rgba(142, 68, 173, 0.3);
            margin-left: 15px;
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .profile-status-bar:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(142, 68, 173, 0.4);
        }

        .status-content {
            display: flex;
            align-items: center;
            gap: 12px;
            color: white;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: white;
        }

        .user-details {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .user-name-display {
            font-weight: 600;
            font-size: 14px;
            color: white;
        }

        .user-status {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.8);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: none;
        }

        .status-actions {
            display: flex;
            gap: 15px;
            margin-left: 8px;
        }

        .status-btn {
            width: auto;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            text-decoration: none;
            transition: all 0.2s ease;
            font-size: 12px;
            padding: 0 10px;
            gap: 5px;
        }

        .status-label {
            font-size: 12px;
            font-weight: 700;
            white-space: nowrap;
        }

        .status-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .status-btn.home-btn:hover {
            background: white;
            color: #8e44ad;
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(142, 68, 173, 0.3);
        }

        .status-btn.watchlist-btn:hover {
            background: white;
            color: #8e44ad;
        }

        .status-btn.bag-btn:hover {
            background: white;
            color: #8e44ad;
        }

        .status-btn.address-btn:hover {
            background: white;
            color: #8e44ad;
        }

        .status-btn.logout-btn:hover {
            background: white;
            color: #8e44ad;
        }

        .status-btn.address-btn:hover {
            background: white;
            color: #8e44ad;
        }
        .cart-icon-container {
            position: relative;
            display: flex;
            align-items: center;
        }

        .cart-badge {
            position: absolute;
            top: -8px;
            right: -12px;
            background-color: #ff6161;
            color: white;
            border-radius: 10px;
            width: 20px;
            height: 20px;
            font-size: 11px;
            display: none;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            border: 1px solid #8e44ad;
        }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }

        /* Address Section */
        .address-section {
            background: white;
            border-radius: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 500;
            color: #212121;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid #8e44ad;
        }

        /* Saved Addresses */
        .saved-addresses {
            margin-bottom: 20px;
        }

        .address-card {
            border: 2px solid #f0f0f0;
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .address-card:hover {
            border-color: #8e44ad;
            box-shadow: 0 2px 8px rgba(142, 68, 173, 0.1);
        }

        .address-card.selected {
            border-color: #8e44ad;
            background: #f8f9fa;
        }

        .address-card .radio-btn {
            position: absolute;
            right: 16px;
            top: 16px;
            width: 20px;
            height: 20px;
            border: 2px solid #d7d7d7;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .address-card.selected .radio-btn {
            border-color: #8e44ad;
        }

        .address-card.selected .radio-btn::after {
            content: '';
            width: 8px;
            height: 8px;
            background: #8e44ad;
            border-radius: 50%;
        }

        .address-name {
            font-size: 16px;
            font-weight: 600;
            color: #212121;
            margin-bottom: 4px;
        }

        .address-details {
            color: #878787;
            font-size: 14px;
            line-height: 1.4;
            margin-bottom: 8px;
        }

        .address-phone {
            color: #212121;
            font-size: 14px;
            font-weight: 500;
        }

        .default-badge {
            background: #388e3c;
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 8px;
        }

        /* Add Address Button */
        .add-address-btn {
            background: #8e44ad;
            color: white;
            border: 1px solid #8e44ad;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 20px;
        }

        .add-address-btn:hover {
            background: #9356ad;
        }

        /* Add Address Form */
        .address-form {
            display: none;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 16px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-size: 14px;
            font-weight: 500;
            color: #212121;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #d7d7d7;
            border-radius: 10px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #8e44ad;
        }

        .form-group input.error {
            border-color: #ff6161;
        }

        .error-message {
            color: #ff6161;
            font-size: 12px;
            margin-top: 4px;
            display: none;
        }

        .address-type {
            display: flex;
            gap: 16px;
            margin-bottom: 16px;
        }

        .address-type label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            cursor: pointer;
        }

        .address-type input[type="radio"] {
            margin: 0;
        }

        /* Action Buttons */
        .form-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .save-btn {
            background: #388e3c;
            color: white;
            border: 1px solid #388e3c;
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .save-btn:hover {
            background: #2e7d32;
        }

        .cancel-btn {
            background: white;
            color: #878787;
            border: 1px solid #d7d7d7;
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .cancel-btn:hover {
            border-color: #8e44ad;
            color: #8e44ad;
        }

        /* Continue Button */
        .continue-btn {
            width: 100%;
            background: #8e44ad;
            color: white;
            border: 1px solid #8e44ad;
            padding: 16px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.2s;
            margin-top: 20px;
        }

        .continue-btn:hover {
            background: #9356ad;
        }

        .continue-btn:disabled {
            background: #f0f0f0;
            color: #878787;
            cursor: not-allowed;
        }

        /* Order Summary */
        .order-summary {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .summary-title {
            font-size: 18px;
            font-weight: 500;
            color: #212121;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid #8e44ad;
        }

        /* Price Details Section */
        .price-details-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-top: 12px;
        }

        .price-details-title {
            font-size: 18px;
            font-weight: 600;
            color: #212121;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid #8e44ad;
            position: relative;
        }

        .price-details-title::after {
            content: '';
            position: absolute;
            right: 0;
            bottom: -2px;
            width: 60px;
            height: 2px;
            background: #8e44ad;
        }

        .order-items {
            margin-bottom: 20px;
        }

        .order-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .order-item img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 10px;
            margin-right: 12px;
        }

        .order-item-details {
            flex-grow: 1;
        }

        .order-item-details h4 {
            font-size: 14px;
            font-weight: 500;
            color: #212121;
            margin: 0 0 4px 0;
            line-height: 1.3;
        }

        .order-item-details .quantity {
            font-size: 12px;
            color: #878787;
        }

        .order-item-price {
            font-size: 14px;
            font-weight: 600;
            color: #212121;
        }

        .price-breakdown {
            margin-bottom: 20px;
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .price-row.total {
            border-top: 1px solid #f0f0f0;
            padding-top: 12px;
            font-size: 16px;
            font-weight: 600;
            color: #212121;
        }

        /* Price Details Styling */
        .price-details-list {
            margin-bottom: 20px;
        }

        .price-detail-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 14px;
            color: #212121;
        }

        .price-detail-item .label {
            flex-grow: 1;
        }

        .price-detail-item .value {
            font-weight: 500;
        }

        .price-detail-item.total {
            border-top: 1px solid #e0e0e0;
            padding-top: 12px;
            font-size: 16px;
            font-weight: 600;
            color: #212121;
        }

        .price-detail-item.discount {
            color: #388e3c;
        }

        .price-detail-item .old-price {
            text-decoration: line-through;
            color: #878787;
            margin-left: 8px;
        }

        /* Savings Message */
        .savings-message {
            background: #e8f5e8;
            border: 1px solid #388e3c;
            border-radius: 8px;
            padding: 12px 16px;
            margin-top: 16px;
            text-align: center;
        }

        .savings-text {
            color: #388e3c;
            font-size: 14px;
            font-weight: 600;
        }

        .savings-amount {
            color: #2e7d32;
            font-size: 16px;
            font-weight: 700;
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .container {
                padding: 0 12px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .address-type {
                flex-direction: column;
                gap: 8px;
            }

            .form-actions {
                flex-direction: column;
            }

            .save-btn, .cancel-btn {
                width: 100%;
            }

            .price-detail-item {
                font-size: 13px;
            }

            .price-detail-item.total {
                font-size: 15px;
            }

            .savings-message {
                padding: 10px 12px;
            }

            .savings-text {
                font-size: 13px;
            }

            .savings-amount {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h2>
            <img src="images/logo.png" alt="Lunsara Logo" class="logo">
            Lunsara
        </h2>

        <nav class="navbar">
            <!-- Authentication Buttons -->
            <div class="auth-buttons">
                <a href="login.html" class="auth-login" style="display: none;">
                    <i class="fas fa-sign-in-alt"></i>
                    Login
                </a>

                <!-- Profile Status Bar -->
                <div class="profile-status-bar" id="profile-status-bar">
                    <div class="status-content">
                        <div class="user-avatar">
                            <i class="fas fa-user-circle"></i>
                        </div>
                        <div class="user-details">
                            <div class="user-name-display" id="user-name-display">Welcome!</div>
                            <div class="user-status">Premium Member</div>
                        </div>
                        <div class="status-actions">
                            <a href="homepage.html" class="status-btn home-btn" title="Home">
                                <span class="status-label">Home</span>
                                <i class="fas fa-home"></i>
                            </a>
                            <a href="watchlist.html" class="status-btn watchlist-btn" title="Watchlist">
                                <span class="status-label">Watchlist</span>
                                <i class="fas fa-heart"></i>
                            </a>
                            <a href="#" class="status-btn logout-btn" onclick="handleLogout(event)" title="Logout">
                                <span class="status-label">Logout</span>
                                <i class="fas fa-sign-out-alt"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
    </header>


    <main class="container">
        <div class="address-section">
            <div class="section-title">Select Delivery Address</div>

            <!-- Saved Addresses -->
            <div class="saved-addresses" id="saved-addresses">
                <!-- Saved addresses will be displayed here -->
            </div>

            <!-- Add Address Button -->
            <button class="add-address-btn" onclick="showAddAddressForm()">
                <i class="fas fa-plus"></i>
                Add New Address
            </button>

            <!-- Add Address Form -->
            <div class="address-form" id="address-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="firstName">First Name *</label>
                        <input type="text" id="firstName" required>
                        <div class="error-message">First name is required</div>
                    </div>
                    <div class="form-group">
                        <label for="lastName">Last Name *</label>
                        <input type="text" id="lastName" required>
                        <div class="error-message">Last name is required</div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="phone">Phone Number *</label>
                    <input type="tel" id="phone" required>
                    <div class="error-message">Valid phone number is required</div>
                </div>

                <div class="form-group">
                    <label for="email">Email Address *</label>
                    <input type="email" id="email" required>
                    <div class="error-message">Valid email address is required</div>
                </div>

                <div class="form-group">
                    <label for="address">Address *</label>
                    <input type="text" id="address" placeholder="Street address" required>
                    <div class="error-message">Address is required</div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="city">City *</label>
                        <input type="text" id="city" required>
                        <div class="error-message">City is required</div>
                    </div>
                    <div class="form-group">
                        <label for="state">State *</label>
                        <select id="state" required>
                            <option value="">Select State</option>
                            <option value="AP">Andhra Pradesh</option>
                            <option value="AR">Arunachal Pradesh</option>
                            <option value="AS">Assam</option>
                            <option value="BR">Bihar</option>
                            <option value="CG">Chhattisgarh</option>
                            <option value="GA">Goa</option>
                            <option value="GJ">Gujarat</option>
                            <option value="HR">Haryana</option>
                            <option value="HP">Himachal Pradesh</option>
                            <option value="JK">Jammu and Kashmir</option>
                            <option value="JH">Jharkhand</option>
                            <option value="KA">Karnataka</option>
                            <option value="KL">Kerala</option>
                            <option value="MP">Madhya Pradesh</option>
                            <option value="MH">Maharashtra</option>
                            <option value="MN">Manipur</option>
                            <option value="ML">Meghalaya</option>
                            <option value="MZ">Mizoram</option>
                            <option value="NL">Nagaland</option>
                            <option value="OR">Odisha</option>
                            <option value="PB">Punjab</option>
                            <option value="RJ">Rajasthan</option>
                            <option value="SK">Sikkim</option>
                            <option value="TN">Tamil Nadu</option>
                            <option value="TG">Telangana</option>
                            <option value="TR">Tripura</option>
                            <option value="UP">Uttar Pradesh</option>
                            <option value="UT">Uttarakhand</option>
                            <option value="WB">West Bengal</option>
                        </select>
                        <div class="error-message">State is required</div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="pincode">Pincode *</label>
                        <input type="text" id="pincode" maxlength="6" required>
                        <div class="error-message">Valid pincode is required</div>
                    </div>
                    <div class="form-group">
                        <label for="landmark">Landmark (Optional)</label>
                        <input type="text" id="landmark" placeholder="Near railway station, etc.">
                    </div>
                </div>

                <div class="address-type">
                    <label>
                        <input type="radio" name="addressType" value="home" checked>
                        Home
                    </label>
                    <label>
                        <input type="radio" name="addressType" value="work">
                        Work
                    </label>
                    <label>
                        <input type="radio" name="addressType" value="other">
                        Other
                    </label>
                </div>

                <div class="form-actions">
                    <button class="cancel-btn" onclick="hideAddAddressForm()">Cancel</button>
                    <button class="save-btn" onclick="saveAddress()">Save Address</button>
                </div>
            </div>

            <!-- Continue Button -->
            <button class="continue-btn" onclick="continueToPayment()" id="continue-btn" disabled>
                Continue to Payment
            </button>
        </div>

        <!-- Order Summary -->
        <div class="order-summary">
            <div class="summary-title">Order Summary</div>
            <div class="order-items" id="order-items">
            </div>
        </div>

        <!-- Price Details Section -->
        <div class="price-details-section">
            <div class="price-details-title">Price Details</div>
            <div class="price-details-list">
                <div class="price-detail-item">
                    <span class="label">Price (<span id="total-items-count">0</span> items)</span>
                    <span class="value" id="price-items">₹0</span>
                </div>
                <div class="price-detail-item">
                    <span class="label">Discount</span>
                    <span class="value discount" id="discount-amount">-₹0</span>
                </div>
                <div class="price-detail-item">
                    <span class="label">Delivery Charges</span>
                    <span class="value" id="delivery-charges">₹40</span>
                </div>
                <div class="price-detail-item">
                    <span class="label">Secured Packaging Fee</span>
                    <span class="value" id="packaging-fee">₹29</span>
                </div>
                <div class="price-detail-item">
                    <span class="label">Taxes & Fees</span>
                    <span class="value" id="taxes-fees">₹0</span>
                </div>
                <div class="price-detail-item total">
                    <span class="label">Total Amount</span>
                    <span class="value" id="total-amount">₹0</span>
                </div>
            </div>

            <!-- Savings Message -->
            <div class="savings-message">
                <div class="savings-text">
                    You will save <span class="savings-amount" id="savings-amount">₹0</span> on this order!
                </div>
            </div>
        </div>
    </main>

   <div id="logout-modal" class="logout-modal">
    <div class="logout-modal-content">
        <div class="logout-modal-icon">
            <i class="fas fa-sign-out-alt"></i>
        </div>
        <h3 class="logout-modal-title">Confirm Logout</h3>
        <p class="logout-modal-message">
            Are you sure you want to logout? You'll need to sign in again to access your account.
        </p>
        <div class="logout-modal-buttons">
            <button class="logout-modal-btn logout-modal-btn-primary" onclick="confirmLogout()">
                Yes, Logout
            </button>
            <button class="logout-modal-btn logout-modal-btn-secondary" onclick="cancelLogout()">
                Cancel
            </button>
        </div>
    </div>
</div>

    <script src="auth.js"></script>
    <script>
        // Load data when page loads
        document.addEventListener('DOMContentLoaded', () => {
            loadSavedAddresses();
            loadOrderSummary();
            updateCartBadge();

            // Initialize user interface after a small delay to ensure auth.js loads
            setTimeout(() => {
                updateUserInterface();
            }, 100);
        });

        /**
         * Updates the cart count badge in the header.
         */
        function updateCartBadge() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const cartCountElement = document.getElementById('cart-count');

            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);

            if (cartCountElement) {
                cartCountElement.innerText = totalItems;
                if (totalItems > 0) {
                    cartCountElement.style.display = 'flex';
                } else {
                    cartCountElement.style.display = 'none';
                }
            }
        }

        /**
         * Loads and displays saved addresses
         */
        function loadSavedAddresses() {
            const savedAddresses = JSON.parse(localStorage.getItem('deliveryAddresses')) || [];
            const savedAddressesContainer = document.getElementById('saved-addresses');

            if (savedAddresses.length === 0) {
                savedAddressesContainer.innerHTML = '<p style="color: #878787; text-align: center; padding: 20px;">No saved addresses. Add a new address to continue.</p>';
                return;
            }

            savedAddressesContainer.innerHTML = '';
            savedAddresses.forEach((address, index) => {
                const addressCard = document.createElement('div');
                addressCard.classList.add('address-card');
                addressCard.onclick = () => selectAddress(index);

                const addressTypeLabel = address.type.charAt(0).toUpperCase() + address.type.slice(1);
                const isDefault = address.isDefault ? '<span class="default-badge">Default</span>' : '';

                addressCard.innerHTML = `
                    <div class="radio-btn"></div>
                    <div class="address-name">${address.firstName} ${address.lastName} ${isDefault}</div>
                    <div class="address-details">
                        ${address.address}<br>
                        ${address.city}, ${address.state} - ${address.pincode}<br>
                        ${address.landmark ? address.landmark + '<br>' : ''}
                        Phone: ${address.phone}
                    </div>
                    <div class="address-phone">Type: ${addressTypeLabel}</div>
                `;

                savedAddressesContainer.appendChild(addressCard);
            });
        }

        /**
         * Shows the add address form
         */
        function showAddAddressForm() {
            const form = document.getElementById('address-form');
            form.style.display = 'block';
            document.querySelector('.add-address-btn').style.display = 'none';

            // Scroll to form
            form.scrollIntoView({ behavior: 'smooth' });
        }

        /**
         * Hides the add address form
         */
        function hideAddAddressForm() {
            const form = document.getElementById('address-form');
            form.style.display = 'none';
            document.querySelector('.add-address-btn').style.display = 'flex';

            // Reset form
            document.getElementById('address-form').reset();
            document.querySelectorAll('.error-message').forEach(error => {
                error.style.display = 'none';
            });
        }

        /**
         * Validates the address form
         */
        function validateAddressForm() {
            const firstName = document.getElementById('firstName').value.trim();
            const lastName = document.getElementById('lastName').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const email = document.getElementById('email').value.trim();
            const address = document.getElementById('address').value.trim();
            const city = document.getElementById('city').value.trim();
            const state = document.getElementById('state').value;
            const pincode = document.getElementById('pincode').value.trim();

            let isValid = true;

            // Reset all error messages
            document.querySelectorAll('.error-message').forEach(error => {
                error.style.display = 'none';
            });

            // Validate first name
            if (!firstName) {
                showAddressError('firstName', 'First name is required');
                isValid = false;
            }

            // Validate last name
            if (!lastName) {
                showAddressError('lastName', 'Last name is required');
                isValid = false;
            }

            // Validate phone
            const phoneRegex = /^[6-9]\d{9}$/;
            if (!phone || !phoneRegex.test(phone)) {
                showAddressError('phone', 'Please enter a valid 10-digit mobile number');
                isValid = false;
            }

            // Validate email
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!email || !emailRegex.test(email)) {
                showAddressError('email', 'Please enter a valid email address');
                isValid = false;
            }

            // Validate address
            if (!address) {
                showAddressError('address', 'Address is required');
                isValid = false;
            }

            // Validate city
            if (!city) {
                showAddressError('city', 'City is required');
                isValid = false;
            }

            // Validate state
            if (!state) {
                showAddressError('state', 'Please select a state');
                isValid = false;
            }

            // Validate pincode
            const pincodeRegex = /^\d{6}$/;
            if (!pincode || !pincodeRegex.test(pincode)) {
                showAddressError('pincode', 'Please enter a valid 6-digit pincode');
                isValid = false;
            }

            return isValid;
        }

        /**
         * Shows error message for address form field
         */
        function showAddressError(fieldId, message) {
            const field = document.getElementById(fieldId);
            const errorMessage = field.parentElement.querySelector('.error-message');
            field.classList.add('error');
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
        }

        /**
         * Saves a new address
         */
        function saveAddress() {
            if (!validateAddressForm()) {
                return;
            }

            const addressData = {
                firstName: document.getElementById('firstName').value.trim(),
                lastName: document.getElementById('lastName').value.trim(),
                phone: document.getElementById('phone').value.trim(),
                email: document.getElementById('email').value.trim(),
                address: document.getElementById('address').value.trim(),
                city: document.getElementById('city').value.trim(),
                state: document.getElementById('state').value,
                pincode: document.getElementById('pincode').value.trim(),
                landmark: document.getElementById('landmark').value.trim(),
                type: document.querySelector('input[name="addressType"]:checked').value,
                isDefault: false
            };

            // Get existing addresses
            const savedAddresses = JSON.parse(localStorage.getItem('deliveryAddresses')) || [];

            // If this is the first address, make it default
            if (savedAddresses.length === 0) {
                addressData.isDefault = true;
            }

            // Add new address
            savedAddresses.push(addressData);

            // Save to localStorage
            localStorage.setItem('deliveryAddresses', JSON.stringify(savedAddresses));

            // Hide form and reload addresses
            hideAddAddressForm();
            loadSavedAddresses();

            alert('Address saved successfully!');
        }

        /**
         * Selects an address
         */
        function selectAddress(index) {
            // Remove selected class from all cards
            document.querySelectorAll('.address-card').forEach(card => {
                card.classList.remove('selected');
            });

            // Add selected class to clicked card
            const selectedCard = document.querySelectorAll('.address-card')[index];
            if (selectedCard) {
                selectedCard.classList.add('selected');
            }

            // Enable continue button
            document.getElementById('continue-btn').disabled = false;

            // Store selected address index
            localStorage.setItem('selectedAddressIndex', index);
        }

        /**
         * Continues to payment
         */
        function continueToPayment() {
            const selectedAddressIndex = localStorage.getItem('selectedAddressIndex');
            if (selectedAddressIndex === null) {
                alert('Please select a delivery address');
                return;
            }

            // Store selected address for checkout
            const savedAddresses = JSON.parse(localStorage.getItem('deliveryAddresses')) || [];
            const selectedAddress = savedAddresses[selectedAddressIndex];
            localStorage.setItem('selectedDeliveryAddress', JSON.stringify(selectedAddress));

            // Redirect to checkout
            window.location.href = 'checkout.html';
        }

        /**
         * Loads order summary
         */
        function loadOrderSummary() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const orderItemsContainer = document.getElementById('order-items');

            if (cart.length === 0) {
                window.location.href = 'cart.html';
                return;
            }

            orderItemsContainer.innerHTML = '';

            let grandTotal = 0;
            let totalItems = 0;

            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                grandTotal += itemTotal;
                totalItems += item.quantity;

                const orderItemElement = document.createElement('div');
                orderItemElement.classList.add('order-item');
                orderItemElement.innerHTML = `
                    <img src="${item.image}" alt="${item.name}">
                    <div class="order-item-details">
                        <h4>${item.name}</h4>
                        <div class="quantity">Qty: ${item.quantity}</div>
                    </div>
                    <div class="order-item-price">₹${itemTotal.toLocaleString()}</div>
                `;
                orderItemsContainer.appendChild(orderItemElement);
            });

            // Update price details section
            updatePriceDetails(grandTotal, totalItems);
        }

        /**
         * Updates the price details section with Flipkart-style breakdown
         */
        function updatePriceDetails(grandTotal, totalItems) {
            // Calculate individual components
            const mrpTotal = Math.round(grandTotal * 1.3); // Original MRP (30% higher)
            const discountAmount = mrpTotal - grandTotal;
            const deliveryCharges = grandTotal > 500 ? 0 : 40;
            const packagingFee = 29;
            const taxes = Math.round(grandTotal * 0.18);
            const finalTotal = grandTotal + deliveryCharges + packagingFee + taxes;

            // Update all price detail elements
            document.getElementById('total-items-count').textContent = totalItems;
            document.getElementById('price-items').textContent = `₹${mrpTotal.toLocaleString()}`;
            document.getElementById('discount-amount').textContent = `-₹${discountAmount.toLocaleString()}`;
            document.getElementById('delivery-charges').textContent = deliveryCharges === 0 ? 'FREE' : `₹${deliveryCharges}`;
            document.getElementById('packaging-fee').textContent = `₹${packagingFee}`;
            document.getElementById('taxes-fees').textContent = `₹${taxes.toLocaleString()}`;
            document.getElementById('total-amount').textContent = `₹${finalTotal.toLocaleString()}`;

            // Update savings message
            const totalSavings = discountAmount + (deliveryCharges === 0 ? 40 : 0); // Discount + free delivery savings
            document.getElementById('savings-amount').textContent = `₹${totalSavings.toLocaleString()}`;
        }

        // Format input fields
        document.getElementById('phone').addEventListener('input', function(e) {
            this.value = this.value.replace(/\D/g, '').substring(0, 10);
        });

        document.getElementById('pincode').addEventListener('input', function(e) {
            this.value = this.value.replace(/\D/g, '').substring(0, 6);
        });

        document.getElementById('firstName').addEventListener('input', function(e) {
            this.value = this.value.replace(/[^a-zA-Z\s]/g, '');
        });

        document.getElementById('lastName').addEventListener('input', function(e) {
            this.value = this.value.replace(/[^a-zA-Z\s]/g, '');
        });

        document.getElementById('city').addEventListener('input', function(e) {
            this.value = this.value.replace(/[^a-zA-Z\s]/g, '');
        });
// This function is called when the logout button is clicked
function handleLogout(event) {
    event.preventDefault();
    showLogoutModal();
}

// Shows the logout confirmation modal with an animation
function showLogoutModal() {
    const modal = document.getElementById('logout-modal');
    modal.style.display = 'flex';

    // A tiny delay allows the browser to apply "display: flex" before starting the animation
    setTimeout(() => {
        modal.classList.add('show');
    }, 10);
}

// Hides the logout confirmation modal with an animation
function hideLogoutModal() {
    const modal = document.getElementById('logout-modal');
    modal.classList.remove('show');

    // Wait for the animation to finish before setting display to none
    setTimeout(() => {
        modal.style.display = 'none';
    }, 300);
}

// This function is called by the "Yes, Logout" button inside the modal
function confirmLogout() {
    hideLogoutModal(); // First, hide the modal
    if (window.auth) {
        auth.logout(); // Then, perform the logout action from auth.js
    }
    // Removed the alert as requested
    window.location.href = 'homepage.html'; // Redirect to the homepage
}

// This function is called by the "Cancel" button inside the modal
function cancelLogout() {
    hideLogoutModal();
}

// Add event listeners to close the modal if the user clicks outside of it or presses the Escape key
document.getElementById('logout-modal').addEventListener('click', function(e) {
    if (e.target === this) {
        cancelLogout();
    }
});

document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        const modal = document.getElementById('logout-modal');
        if (modal.style.display === 'flex') {
            cancelLogout();
        }
    }
});
    </script>
</body>
</html>